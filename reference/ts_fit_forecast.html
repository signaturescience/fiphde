<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content='This function allows the user to fit time series models and forecast values out to a specified horizon. Starting from a tsibble object (see make_tsibble), the function fits the models specified as a list in the "models" argument. The "Details" section provides more information on how to parameterize the models used. Note that if the input tsibble is "keyed" (e.g., grouped by location) then the procedure will fit and forecast independently for each grouping.'><title>Fit and forecast with time-series approaches — ts_fit_forecast • fiphde</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fit and forecast with time-series approaches — ts_fit_forecast"><meta property="og:description" content='This function allows the user to fit time series models and forecast values out to a specified horizon. Starting from a tsibble object (see make_tsibble), the function fits the models specified as a list in the "models" argument. The "Details" section provides more information on how to parameterize the models used. Note that if the input tsibble is "keyed" (e.g., grouped by location) then the procedure will fit and forecast independently for each grouping.'><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">fiphde</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/basic_usage.html">Basic Usage</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Fit and forecast with time-series approaches</h1>
      
      <div class="d-none name"><code>ts_fit_forecast.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function allows the user to fit time series models and forecast values out to a specified horizon. Starting from a <code>tsibble</code> object (see <a href="make_tsibble.html">make_tsibble</a>), the function fits the models specified as a list in the "models" argument. The "Details" section provides more information on how to parameterize the models used. Note that if the input <code>tsibble</code> is "keyed" (e.g., grouped by location) then the procedure will fit and forecast independently for each grouping.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ts_fit_forecast</span><span class="op">(</span></span>
<span>  <span class="va">prepped_tsibble</span>,</span>
<span>  outcome <span class="op">=</span> <span class="st">"flu.admits"</span>,</span>
<span>  horizon <span class="op">=</span> <span class="fl">4L</span>,</span>
<span>  trim_date <span class="op">=</span> <span class="st">"2021-01-01"</span>,</span>
<span>  models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>arima <span class="op">=</span> <span class="st">"PDQ(0, 0, 0) + pdq(1:2, 0:2, 0)"</span>, ets <span class="op">=</span></span>
<span>    <span class="st">"season(method=\"N\")"</span>, nnetar <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>,</span>
<span>  covariates <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ensemble <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>prepped_tsibble</dt>
<dd><p>A <code>tsibble</code> with data formatted via <a href="make_tsibble.html">make_tsibble</a></p></dd>


<dt>outcome</dt>
<dd><p>The outcome variable to model; default is <code>"flu.admits"</code></p></dd>


<dt>horizon</dt>
<dd><p>Number of weeks ahead to forecast</p></dd>


<dt>trim_date</dt>
<dd><p>The date (YYYY-MM-DD) at which time series models should start fitting; default <code>"2021-01-01"</code>; if set to <code>NULL</code> the input data will not be trimmed (i.e., all data will be used to fit time series models)</p></dd>


<dt>models</dt>
<dd><p>A list of right hand side formula contents for models you want to run; default is <code>list(arima='PDQ(0, 0, 0) + pdq(1:2, 0:2, 0)', ets='season(method="N")', nnetar=NULL)</code> which runs a constrained ARIMA, non-seasonal ETS, and ignores the NNETAR model; see "Details" for more information</p></dd>


<dt>covariates</dt>
<dd><p>Logical. Should flu hospitalization-specific covariates that should be modeled with the time series? If so, historical hospitalization and ILI rank for each epidemiological week, brought in with <a href="prep_hdgov_hosp.html">prep_hdgov_hosp</a>, is added to the ARIMA model.</p></dd>


<dt>ensemble</dt>
<dd><p>Logical as to whether or not the models should be ensembled (using mean); default <code>TRUE</code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A list of the time series fit, time series forecast, and model formulas.</p><ul><li><p><strong>tsfit</strong>: A <code>mdl_df</code> class "mable" with one row for each location, columns for arima and ets models.</p></li>
<li><p><strong>tsfor</strong>: A <code>fbl_ts</code> class "fable" with one row per location-model-timepoint up to <code>horizon</code> number of time points.</p></li>
<li><p><strong>formulas</strong>: A list of ARIMA, ETS, and/or NNETAR formulas</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>When fitting time series models, the set of models used (and their parameters) can be defined via a named list passed to the "models" argument. The list should contain elements that define the right-hand side of model formulas. The function internally uses the <a href="https://fable.tidyverts.org/reference/fable-package.html" class="external-link">fable::fable</a> package, and any models provided must be part of the <code>fable</code> ecosystem of time series models. The models passed must be named as "arima", "ets", and "nnetar". To skip any one of these models set the named argument for the given model to <code>NULL</code>. The "models" argument defaults to <code>list(arima = "PDQ(0, 0, 0) + pdq(1:2, 0:2, 0)", ets = "season(method='N')", nnetar = NULL)</code>. To run an unconstrained ARIMA: <code>list(arima='PDQ() + pdq()')</code> (see <a href="https://fable.tidyverts.org/reference/ARIMA.html" class="external-link">fable::ARIMA</a>). To run a seasonal exponential smoothing: <code>list(ets='season(method=c("A", "M", "N"), period="3 months")')</code> (see <a href="https://fable.tidyverts.org/reference/ETS.html" class="external-link">fable::ETS</a>). To run an autoregressive neural net with P=1: <code>list(nnetar="AR(P=1)")</code> (see <a href="https://fable.tidyverts.org/reference/NNETAR.html" class="external-link">fable::NNETAR</a>).</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p><a href="https://fable.tidyverts.org/" class="external-link">https://fable.tidyverts.org/</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># Retrieve hospitalization data</span></span></span>
<span class="r-in"><span><span class="va">h_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="get_hdgov_hosp.html">get_hdgov_hosp</a></span><span class="op">(</span>limitcols<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Prepare and summarize hospitalization data to weekly resolution</span></span></span>
<span class="r-in"><span><span class="va">prepped_hosp</span> <span class="op">&lt;-</span> <span class="fu"><a href="prep_hdgov_hosp.html">prep_hdgov_hosp</a></span><span class="op">(</span><span class="va">h_raw</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Create a keyed time series tibble with only locations of interest</span></span></span>
<span class="r-in"><span><span class="va">prepped_tsibble</span> <span class="op">&lt;-</span> <span class="fu"><a href="make_tsibble.html">make_tsibble</a></span><span class="op">(</span><span class="va">prepped_hosp</span>,</span></span>
<span class="r-in"><span>                                epiyear <span class="op">=</span> <span class="va">epiyear</span>,</span></span>
<span class="r-in"><span>                                epiweek<span class="op">=</span><span class="va">epiweek</span>,</span></span>
<span class="r-in"><span>                                key<span class="op">=</span><span class="va">location</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">location</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"US"</span>, <span class="st">"51"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run with default constrained ARIMA, nonseasonal ETS, no NNETAR</span></span></span>
<span class="r-in"><span><span class="va">hospfor1</span> <span class="op">&lt;-</span> <span class="fu">ts_fit_forecast</span><span class="op">(</span><span class="va">prepped_tsibble</span>,</span></span>
<span class="r-in"><span>                            horizon<span class="op">=</span><span class="fl">4L</span>,</span></span>
<span class="r-in"><span>                            outcome<span class="op">=</span><span class="st">"flu.admits"</span>,</span></span>
<span class="r-in"><span>                            covariates<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Run an unconstrained ARIMA, seasonal ETS, no NNETAR</span></span></span>
<span class="r-in"><span><span class="va">hospfor2</span> <span class="op">&lt;-</span> <span class="fu">ts_fit_forecast</span><span class="op">(</span><span class="va">prepped_tsibble</span>,</span></span>
<span class="r-in"><span>                            horizon<span class="op">=</span><span class="fl">4L</span>,</span></span>
<span class="r-in"><span>                            outcome<span class="op">=</span><span class="st">"flu.admits"</span>,</span></span>
<span class="r-in"><span>                            covariates<span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                            models<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>arima<span class="op">=</span><span class="st">'PDQ() + pdq()'</span>,</span></span>
<span class="r-in"><span>                                        ets<span class="op">=</span><span class="st">'season(method=c("A", "M", "N"), period="3 months")'</span>,</span></span>
<span class="r-in"><span>                                        nnetar<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Run an unconstrained ARIMA, seasonal ETS, NNETAR</span></span></span>
<span class="r-in"><span><span class="va">hospfor3</span> <span class="op">&lt;-</span> <span class="fu">ts_fit_forecast</span><span class="op">(</span><span class="va">prepped_tsibble</span>,</span></span>
<span class="r-in"><span>                            horizon<span class="op">=</span><span class="fl">4L</span>,</span></span>
<span class="r-in"><span>                            outcome<span class="op">=</span><span class="st">"flu.admits"</span>,</span></span>
<span class="r-in"><span>                            covariates<span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                            models<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>arima<span class="op">=</span><span class="st">'PDQ() + pdq()'</span>,</span></span>
<span class="r-in"><span>                                        ets<span class="op">=</span><span class="st">'season(method=c("A", "M", "N"), period="3 months")'</span>,</span></span>
<span class="r-in"><span>                                        nnetar<span class="op">=</span><span class="st">"AR(P=1)"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by VP Nagraj, Shakeel Jessa, Chris Hulme-Lowe, Stephen Turner.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

